{"version":3,"file":"worker/worker.index.js","mappings":"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","sources":["webpack://clarify-ai/./src/services/AuthService.js","webpack://clarify-ai/./src/utils/constants.js","webpack://clarify-ai/./src/handlers/backgroundFunctions.js","webpack://clarify-ai/./src/app.js","webpack://clarify-ai/./src/services/llmService.js"],"sourcesContent":["class AuthService {\n  constructor() {\n    this.userData = null;\n    this.email = null;\n    this.picture = null;\n    this.freeTrial = null;\n  }\n\n  async login() {\n    try {\n      // Step 1: Get authentication token\n      const token = await this.getAuthToken(true);\n\n      // Step 2: Get user credentials using the token\n      const userCreds = await this.getUserCredentials(token);\n\n      // Step 3: Send login request with user credentials\n      const userData = await this.sendLoginRequest(userCreds);\n\n      // Step 4: Update user properties\n      this.updateUserProps(userData);\n\n      console.log(\"Logged in successfully\");\n      return this.userData;\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      throw error;\n    }\n  }\n\n  async logout() {\n    try {\n      // Step 1: Get authentication token\n      const token = await this.getAuthToken(false);\n\n      if (token) {\n        // Step 2: Remove cached authentication token\n        await this.removeCachedAuthToken(token);\n\n        // Step 3: Revoke token\n        await this.revokeToken(token);\n        console.log(\"Logged out successfully\");\n      } else {\n        console.log(\"No token found\");\n      }\n\n      // Step 4: Clear user properties\n      this.updateUserProps(null);\n\n      return { response: \"ok\" };\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      throw error;\n    }\n  }\n\n  async getAuthToken(interactive) {\n    return new Promise((resolve, reject) => {\n      chrome.identity.getAuthToken({ interactive: interactive }, (token) => {\n        if (chrome.runtime.lastError) {\n          reject(chrome.runtime.lastError);\n        } else {\n          resolve(token);\n        }\n      });\n    });\n  }\n\n  async removeCachedAuthToken(token) {\n    return new Promise((resolve, reject) => {\n      chrome.identity.removeCachedAuthToken({ token: token }, () => {\n        if (!chrome.runtime.lastError) {\n          resolve();\n        } else {\n          reject(chrome.runtime.lastError);\n        }\n      });\n    });\n  }\n\n  async revokeToken(token) {\n    const response = await fetch(\n      \"https://accounts.google.com/o/oauth2/revoke?token=\" + token,\n      {\n        method: \"GET\",\n      }\n    );\n    if (!response.ok) {\n      console.error(\"Error revoking token:\", response.statusText);\n    }\n  }\n\n  async getUserCredentials(token) {\n    const response = await fetch(\n      \"https://www.googleapis.com/oauth2/v3/userinfo?access_token=\" + token\n    );\n    if (!response.ok) {\n      throw new Error(\"Failed to fetch user data\");\n    }\n    return await response.json();\n  }\n\n  async sendLoginRequest(user) {\n    const data = JSON.stringify(user);\n    const response = await fetch(\"http://localhost:3001/api/auth/signin\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: data,\n    });\n    if (!response.ok) {\n      console.error(\"Login request failed:\", response.status);\n      throw new Error(\"Login request failed\");\n    }\n\n    return await response.json();\n  }\n\n  updateUserProps(data) {\n    if (!data) {\n      this.userData = null;\n      this.email = null;\n      this.picture = null;\n      this.freeTrial = null;\n      return;\n    }\n    this.userData = data;\n    this.email = data.email;\n    this.picture = data.picture;\n    this.freeTrial = data.freeTrial;\n  }\n}\n\nconst user = new AuthService();\nexport default user;\n","// Urls\nconst BASE_URL = \"http://localhost:3000\";\nconst ONBOARDING_SIGNIN_URL = `${BASE_URL}/onboarding/signin`;\nconst ONBOARDING_SUCCESS_URL = `${BASE_URL}/onboarding/success`;\n\nexport { BASE_URL, ONBOARDING_SIGNIN_URL, ONBOARDING_SUCCESS_URL };\n","import getGeneratedText from \"../services/llmService\";\nimport user from \"../services/AuthService\";\nimport { BASE_URL, ONBOARDING_SUCCESS_URL } from \"../utils/constants\";\n\nexport const openPage = (url) => {\n  chrome.tabs.create({ url }, (tab) => {\n    console.log(\"New tab launched with\", url);\n  });\n};\n\nconst signIn = async (sendResponse) => {\n  await user.login();\n  await chrome.storage.sync.set({ userData: user.userData });\n  sendResponse({ success: true });\n};\n\nexport const signinReq = async (request, sender, sendResponse) => {\n  try {\n    if (sender.origin === BASE_URL) {\n      await signIn(sendResponse);\n      openPage(ONBOARDING_SUCCESS_URL);\n    } else {\n      await signIn(sendResponse);\n    }\n  } catch (error) {\n    sendResponse({ success: false });\n    handleError(error, \"signinReq\");\n  }\n};\n\nexport const logOutReq = async () => {\n  await user.logout();\n  await chrome.storage.sync.set({ userData: null });\n};\n\nexport const generateTextReq = async (request, sender, sendResponse) => {\n  const generatedText = await getGeneratedText({\n    prompt: request.prompt,\n    email: user.email,\n  });\n\n  sendResponse(generatedText);\n};\n\nexport const createContextMenu = () => {\n  try {\n    chrome.contextMenus.create({\n      title: \"Clarity\",\n      contexts: [\"selection\"],\n      id: \"mfbigjpknmeflcogckmjhpghdjbfpmle\",\n    });\n  } catch (error) {\n    handleError(error, \"createContextMenu\");\n  }\n};\n\nexport const executeScript = async () => {\n  const [tab] = await chrome.tabs.query({\n    active: true,\n    lastFocusedWindow: true,\n  });\n\n  chrome.scripting.executeScript({\n    target: { tabId: tab.id },\n    files: [\"./content/content.index.js\"],\n  });\n};\n","import user from \"./services/AuthService\";\nimport { ONBOARDING_SIGNIN_URL } from \"./utils/constants\";\nimport {\n  signinReq,\n  logOutReq,\n  generateTextReq,\n  createContextMenu,\n  executeScript,\n  openPage,\n} from \"./handlers/backgroundFunctions\";\n\nconst handleError = (error, context) => {\n  console.error(`Error in ${context}:`, error);\n};\n\nconst handleOnInstalled = (details) => {\n  try {\n    if (details.reason !== \"install\" && details.reason !== \"update\") return;\n    createContextMenu();\n    openPage(ONBOARDING_SIGNIN_URL);\n  } catch (error) {\n    handleError(error, \"handleOnInstalled\");\n  }\n};\n\nconst handleOnStartup = async () => {\n  try {\n    const userData = await chrome.storage.sync.get([\"userData\"]);\n    user.updateUserProps(userData);\n  } catch (error) {\n    handleError(error, \"handleOnStartup\");\n  }\n};\n\nconst handleMessages = (request, sender, sendResponse) => {\n  try {\n    if (request.message === \"signInRequest\") {\n      signinReq(request, sender, sendResponse);\n    } else if (request.message === \"logOutRequest\") {\n      logOutReq();\n    } else if (request.message === \"generateText\") {\n      generateTextReq(request, sender, sendResponse);\n    }\n    return true;\n  } catch (error) {\n    handleError(error, \"handleMessages\");\n  }\n};\n\nconst onContextMenuClicked = async (details) => {\n  try {\n    if (details.menuItemId === \"mfbigjpknmeflcogckmjhpghdjbfpmle\") {\n      if (!user.email) {\n        openOnboardingPage();\n        return;\n      }\n      executeScript();\n    }\n  } catch (error) {\n    handleError(error, \"onContextMenuClicked\");\n  }\n};\n\nconst main = async () => {\n  try {\n    chrome.runtime.onInstalled.addListener(handleOnInstalled);\n    chrome.runtime.onStartup.addListener(handleOnStartup);\n    chrome.contextMenus.onClicked.addListener(onContextMenuClicked);\n    chrome.runtime.onMessageExternal.addListener(handleMessages);\n    chrome.runtime.onMessage.addListener(handleMessages);\n  } catch (error) {\n    handleError(error, \"main\");\n  }\n};\n\nmain();\n","const getGeneratedText = async ({ prompt, email }) => {\n  try {\n    const response = await fetch(\"http://localhost:3001/api/ai/generate\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        prompt,\n        email,\n      }),\n    });\n\n    if (response.status === 402) {\n      return \"Payment required\";\n    }\n\n    const data = await response.json();\n    return data.generatedText;\n  } catch (error) {\n    console.error(\"There was a problem with the fetch operation:\", error);\n  }\n};\n\nexport default getGeneratedText;\n"],"names":["constructor","this","userData","email","picture","freeTrial","login","token","getAuthToken","userCreds","getUserCredentials","sendLoginRequest","updateUserProps","console","log","error","logout","removeCachedAuthToken","revokeToken","response","interactive","Promise","resolve","reject","chrome","identity","runtime","lastError","fetch","method","ok","statusText","Error","json","user","data","JSON","stringify","headers","body","status","BASE_URL","ONBOARDING_SIGNIN_URL","ONBOARDING_SUCCESS_URL","openPage","url","tabs","create","tab","signIn","async","storage","sync","set","sendResponse","success","handleError","context","handleOnInstalled","details","reason","createContextMenu","contextMenus","title","contexts","id","handleOnStartup","get","handleMessages","request","sender","message","origin","signinReq","logOutReq","prompt","generatedText","getGeneratedText","generateTextReq","onContextMenuClicked","menuItemId","openOnboardingPage","query","active","lastFocusedWindow","scripting","executeScript","target","tabId","files","onInstalled","addListener","onStartup","onClicked","onMessageExternal","onMessage","main"],"sourceRoot":""}