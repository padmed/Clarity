(()=>{"use strict";const e=new class{constructor(){this.userData=null,this.email=null,this.picture=null,this.freeTrial=null}async initialize(){const e=await chrome.storage.sync.get(["userData"]);e?this.updateUserProps(e):this.updateUserProps(null)}async login(){try{const e=await this.getAuthToken(!0),t=await this.getUserCredentials(e),o=await this.sendLoginRequest(t);return this.updateUserProps(o),console.log("Logged in successfully"),this.userData}catch(e){throw console.error("Login error:",e),e}}async logout(){try{const e=await this.getAuthToken(!1);return e?(await this.removeCachedAuthToken(e),await this.revokeToken(e),console.log("Logged out successfully")):console.log("No token found"),this.updateUserProps(null),{response:"ok"}}catch(e){throw console.error("Logout error:",e),e}}async getAuthToken(e){return new Promise(((t,o)=>{chrome.identity.getAuthToken({interactive:e},(e=>{chrome.runtime.lastError?o(chrome.runtime.lastError):t(e)}))}))}async removeCachedAuthToken(e){return new Promise(((t,o)=>{chrome.identity.removeCachedAuthToken({token:e},(()=>{chrome.runtime.lastError?o(chrome.runtime.lastError):t()}))}))}async revokeToken(e){const t=await fetch("https://accounts.google.com/o/oauth2/revoke?token="+e,{method:"GET"});t.ok||console.error("Error revoking token:",t.statusText)}async getUserCredentials(e){const t=await fetch("https://www.googleapis.com/oauth2/v3/userinfo?access_token="+e);if(!t.ok)throw new Error("Failed to fetch user data");return await t.json()}async sendLoginRequest(e){const t=JSON.stringify(e),o=await fetch("http://localhost:3001/api/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:t});if(!o.ok)throw console.error("Login request failed:",o.status),new Error("Login request failed");return await o.json()}updateUserProps(e){if(!e)return this.userData=null,this.email=null,this.picture=null,void(this.freeTrial=null);this.userData=e,this.email=e.email,this.picture=e.picture,this.freeTrial=e.freeTrial}},t=document.querySelector(".buttonSignin"),o=document.querySelector(".buttonSignout"),r=document.querySelector(".tokens");(async()=>{await e.initialize();const{userData:s}=e.userData;if(!s)return document.querySelector(".greetUser").textContent="Please log in to continue",t.addEventListener("click",(e=>{chrome.runtime.sendMessage({message:"signInRequest"})})),void(o.style.display="none");document.querySelector(".greetUser").textContent=`Welcome, ${s.email}`,o.addEventListener("click",(e=>{chrome.runtime.sendMessage({message:"logOutRequest"})})),t.style.display="none",console.log(r),r.textContent=`Available tokens: ${s.freeTrial.tokens}/20`})()})();
//# sourceMappingURL=actionMenu.index.js.map